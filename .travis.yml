language: go
go:
  - "1.12.x"
  - "1.13.x"
os:
  - linux
  - osx
go_import_path: fyne.io/fynedesk
gobuild_args: "-v"

addons:
  apt:
    packages:
      - libgl1-mesa-dev
      - xorg-dev

before_script:
- go get golang.org/x/tools/cmd/goimports
- go get github.com/fzipp/gocyclo
- go get golang.org/x/lint/golint
- go get github.com/mattn/goveralls
- GO_FILES=$(find . -iname '*.go' -type f | grep -v /vendor/)

script:
- test -z $(goimports -e -d $GO_FILES | tee /dev/stderr)
- go test -v -covermode=atomic -coverprofile=coverage.out ./...
- go vet ./...
- golint -set_exit_status $(go list)
- gocyclo -over 50 $GO_FILES
- export coverage=$(go tool cover -func coverage.out | tail -n 1 | awk '{ print $3 }' | cut -d \% -f 1 | cut -d \. -f 1)
- if [ $coverage -lt 16 ]; then echo "Test coverage lowered"; exit 1; fi
- |
  set -e
  if [[ "$TRAVIS_PULL_REQUEST" == "false" && -n "$COVERALLS_TOKEN" ]]; then
    go test -covermode=atomic -coverprofile=coverage.out ./...
    $(go env GOPATH | awk 'BEGIN{FS=":"} {print $1}')/bin/goveralls -coverprofile=coverage.out -service=travis-ci -repotoken $COVERALLS_TOKEN
  fi

env:
  matrix:
  - GO111MODULE=on
  global:
  - secure: "iv/OFN4GeOqHkR3nkkapivQkuAB4476HjuxosvhkSr9Ops3s1tK8pXpBw15wRxNTiOBKqipIlBs5aN0j2zdoflhLcaZ+tjUZTFapLYdsFyJoWrHzs6nXZDyPCzo1/u835djusNICKmhV/5U+M8KV9R1YOuLAQZtWzfvuBx5C8r5b0e2tbJxKeFll95Wj3mLmqo09+aZTN4yIkNQd8XwMqf4H1+BsZuuSqw5kMMTNOELPEzNTHB4fvpR+ED+nNVaNG3JHDoKVGweMG0oT4hvNJfFqwW+uXPB3NwlUtZlg+j90/SbYVsPM/m5/X9k6lMEk7653TBkAMbLknda6d1w5+gaXxpjBqw7CUnP9L/fBGKBbgtYYXdEwYY3LnqRewLrHUfPwXqSrZKSL+yhT8/9Q6mpaTmgHUmUg6DAwMZ0iYbgM1IA8rXwHFo1gqFM6cVpZl42Q2bLqVOBDIg/qSeBmMrvcTSIoJ28XAyIdUXxA56OPeDPRaQH6zOgb2A0iTWVEGj58N4ktqgFUaOhwdT3Fvk/vywD+8DFVur/P1nB495Oc0J/BgQbGAdDPbSEty1EK3whtog9gHj0hriD6r502I0Ym7IJH9PyEqrAjcK03EC2fvyWIqJhfirB+X9eFoDVLUYk4pUmWFrDzfvQEAptB4nI/cobu89anc6NOcHJ8YSM="
